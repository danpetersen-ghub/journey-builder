<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]>      <html class="no-js"> <!--<![endif]-->
<html>

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>Starter App</title>
    <meta name="description" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" type="text/css" href="/style.css" />

    <!--Fonts-->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300&display=swap" rel="stylesheet" />

    <!--Bootstrap-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css"
        integrity="sha384-KyZXEAg3QhqLMpG8r+8fhAXLRk2vvoC2f3B09zVXn8CA5QIVfZOJ3BCsw2P0p/We" crossorigin="anonymous" />


    <!--ICON-->
    <script src="https://kit.fontawesome.com/a0886f7045.js" crossorigin="anonymous"></script>
</head>
<!--[if lt IE 7]>
          <p class="browsehappy">
            You are using an <strong>outdated</strong> browser. Please
            <a href="#">upgrade your browser</a> to improve your experience.
          </p>
        <![endif]-->
<div class="container-fluid">
    <div class="row">
        <div class="col-sm-2 col-md-2 col-lg-1">
            <div class="navbar">
                <div class="navbox">
                    <div class="navitem img">
                        <a href="https://www.support.dandevelopment.uk/">
                            <img class="logoImg" src="/img/Topbanner.png">
                        </a>
                    </div>
                    <div class="navitem">
                        <a href="/">
                            <i class="fas fa-home" aria-hidden="true"></i>
                        </a>
                    </div>
                    <div class="navitem">
                        <a href="https://www.support.dandevelopment.uk/">
                            <i class="far fa-question-circle" aria-hidden="true"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-sm-10 col-md-10 col-lg-11">
            <div class="content-container">
                <div class="margin-top" id="login">


                    <h1>Sign Up</h1>
                    <form onsubmit="handleRequest(event)">
                        <label for="email">Email:</label>
                        <input type="email" id="email" name="email" required><br>

                        <label for="password">Password:</label>
                        <input type="password" id="password" name="password" required><br>

                        <button class="login-btn" type="submit">Sign Up</button>
                    </form>
                    <div id="output"></div>


                </div>

            </div>
        </div>
    </div>
</div>

<script>
    async function handleRequest(event) {
        event.preventDefault();
        const outputHTML = document.getElementById("output");

        // Get the form data
        const formData = new FormData(event.target);

        // Convert the FormData to a plain JavaScript object
        const formDataObject = {};
        formData.forEach((value, key) => {
            formDataObject[key] = value;
        });

        try {
            const response = await fetch("/auth/register", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json", // Set the content type to JSON
                },
                body: JSON.stringify(formDataObject), // Convert the data to JSON string
            });

            if (response.status == 201) {
                // The registration was successful
                const responseData = await response.json();
                outputHTML.textContent = responseData.message;

                // Redirect to the home page after 3 seconds
                setTimeout(() => {
                    window.location.href = "/"; // Replace "/" with the URL of your home page
                }, 3000); // 3000 milliseconds (3 seconds)


            } else {
                // The registration failed
                const errorData = await response.json();
                outputHTML.textContent = errorData.error;
            }
        } catch (error) {
            console.error("Error registering user:", error);
            outputHTML.textContent = "Failed to register. Please try again later.";
        }
    }


</script>
</body>

</html>